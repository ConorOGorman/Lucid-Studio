"use strict";Object.defineProperty(exports,Symbol.toStringTag,{value:"Module"});require("@php-wasm/node-polyfills");const p="playground-log",f=(e,...r)=>{E.dispatchEvent(new CustomEvent(p,{detail:{log:e,args:r}}))},v=(e,...r)=>{switch(typeof e.message=="string"?Reflect.set(e,"message",l(e.message)):e.message.message&&typeof e.message.message=="string"&&Reflect.set(e.message,"message",l(e.message.message)),e.severity){case t.Debug:console.debug(e.message,...r);break;case t.Info:console.info(e.message,...r);break;case t.Warn:console.warn(e.message,...r);break;case t.Error:console.error(e.message,...r);break;case t.Fatal:console.error(e.message,...r);break;default:console.log(e.message,...r)}},P=e=>e instanceof Error?[e.message,e.stack].join(`
`):JSON.stringify(e,null,2),g=[],u=e=>{g.push(e)},i=e=>{if(e.raw===!0)u(e.message);else{const r=w(typeof e.message=="object"?P(e.message):e.message,e.severity,e.prefix??a.JS);u(r)}},T=()=>{g.length=0};let c=0;const m="/wordpress/wp-content/debug.log",S=async e=>await e.fileExists(m)?await e.readFileAsText(m):"",W=(e,r)=>{r.addEventListener("request.end",async()=>{const s=await S(r);if(s.length>c){const o=s.substring(c);e.logMessage({message:o,severity:t.Log,raw:!0}),c=s.length}}),r.addEventListener("request.error",s=>{s=s,s.error&&(e.logMessage({message:`${s.error.message} ${s.error.stack}`,severity:t.Fatal,prefix:s.source==="request"?a.PHP:a.WASM}),e.dispatchEvent(new CustomEvent(e.fatalErrorEvent,{detail:{logs:e.getLogs(),source:s.source}})))})},t={Fatal:{name:"fatal",level:0},Error:{name:"error",level:1},Warn:{name:"warn",level:2},Log:{name:"log",level:3},Info:{name:"info",level:4},Debug:{name:"debug",level:5}},a={WASM:"Wasm Crash",PHP:"PHP",JS:"JavaScript"};class L extends EventTarget{constructor(r=[]){super(),this.fatalErrorEvent="playground-fatal-error",this.severity=t.Info,this.handlers=r}getLogs(){return this.handlers.includes(i)?[...g]:(this.error(`Logs aren't stored because the logToMemory handler isn't registered.
				If you're using a custom logger instance, make sure to register logToMemory handler.
			`),[])}logMessage(r,...s){const o={...r,severity:r.severity??t.Log};for(const n of this.handlers)o.severity.level<=this.severity.level&&n(o,...s)}setSeverityFilterLevel(r){this.severity=r}log(r,...s){this.logMessage({message:r,severity:t.Log,prefix:a.JS,raw:!1},...s)}debug(r,...s){this.logMessage({message:r,severity:t.Debug,prefix:a.JS,raw:!1},...s)}info(r,...s){this.logMessage({message:r,severity:t.Info,prefix:a.JS,raw:!1},...s)}warn(r,...s){this.logMessage({message:r,severity:t.Warn,prefix:a.JS,raw:!1},...s)}error(r,...s){this.logMessage({message:r,severity:t.Error,prefix:a.JS,raw:!1},...s)}}const O=()=>{try{if(process.env.NODE_ENV==="test")return[i,f]}catch{}return[i,v,f]},E=new L(O()),l=e=>e.replace(/\t/g,""),w=(e,r,s)=>{const o=new Date,n=new Intl.DateTimeFormat("en-GB",{year:"numeric",month:"short",day:"2-digit",timeZone:"UTC"}).format(o).replace(/ /g,"-"),b=new Intl.DateTimeFormat("en-GB",{hour:"2-digit",minute:"2-digit",second:"2-digit",hour12:!1,timeZone:"UTC",timeZoneName:"short"}).format(o),M=n+" "+b;return e=l(e),`[${M}] ${s} ${r.name}: ${e}`},k=(e,r)=>{e.addEventListener(e.fatalErrorEvent,r)},x=(e,r)=>{e.logMessage({message:`${r.message} in ${r.filename} on line ${r.lineno}:${r.colno}`,severity:t.Error})},y=(e,r)=>{if(!(r!=null&&r.reason))return;const s=(r==null?void 0:r.reason.stack)??r.reason;e.logMessage({message:s,severity:t.Error})};let d=0;const $=e=>{navigator.serviceWorker.addEventListener("message",r=>{var s,o,n;((s=r.data)==null?void 0:s.numberOfOpenPlaygroundTabs)!==void 0&&d!==((o=r.data)==null?void 0:o.numberOfOpenPlaygroundTabs)&&(d=(n=r.data)==null?void 0:n.numberOfOpenPlaygroundTabs,e.debug(`Number of open Playground tabs is: ${d}`))})};let h=!1;const C=e=>{h||($(e),!(typeof window>"u")&&(window.addEventListener("error",r=>x(e,r)),window.addEventListener("unhandledrejection",r=>y(e,r)),window.addEventListener("rejectionhandled",r=>y(e,r)),h=!0))},D=e=>{e.addEventListener("activate",()=>{e.clients.matchAll().then(r=>{const s={numberOfOpenPlaygroundTabs:r.filter(o=>o.frameType==="top-level").length};for(const o of r)o.postMessage(s)})})};exports.LogPrefix=a;exports.LogSeverity=t;exports.Logger=L;exports.addCrashListener=k;exports.clearMemoryLogs=T;exports.collectPhpLogs=W;exports.collectWindowErrors=C;exports.errorLogPath=m;exports.formatLogEntry=w;exports.logEvent=f;exports.logEventType=p;exports.logToConsole=v;exports.logToMemory=i;exports.logger=E;exports.logs=g;exports.prepareLogMessage=l;exports.reportServiceWorkerMetrics=D;
//# sourceMappingURL=index.cjs.map
